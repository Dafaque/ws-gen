// Code generated by wsgen. DO NOT EDIT.
import 'package:web_socket_channel/web_socket_channel.dart';
import 'package:{{get_param "module"}}/{{get_param "package"}}/model/model.dart';
import 'package:{{get_param "module"}}/{{get_param "package"}}/serialization/coder.dart';

class MessageSender {
    late final WebSocketChannel chan;
    late final Coder coder;
    MessageSender(
        String addr,
        {{- if .Init.Params }}
        InitParams params,
        {{- end }}
        this.coder,
    ) {
        {{- if .Init.Params }}
        addr += params.toQuery();
        {{- end }}
        chan = WebSocketChannel.connect(Uri.parse(addr));
    }

    void _send(Encodable msg) {
        final dynamic data = coder.encode(msg);
        chan.sink.add(data);
    }
    {{- range $msg := .Messages}}
    {{- $name := sconv $msg.Name}}
    void send{{$name}}({{$name}} msg) {
        _send(msg);
    }
    {{- end}}
}