// Code generated by wsgen. DO NOT EDIT.
import 'package:{{get_param "module"}}/{{get_param "package"}}/model/model.dart';
{{- if eq .Encoding "json"}}
import 'dart:convert' show json;
var encoder = json;
{{- end}}

abstract class Encodable {
  dynamic toEncodable();
}

abstract class Coder {
    dynamic encode(Encodable m);
    Encodable decode(dynamic data);
}

class DefaultCoder implements Coder {
  @override
  dynamic encode(Encodable m) {
    return encoder.encode(m, toEncodable: (obj) => (obj as Encodable).toEncodable());
  }

  @override
  Encodable decode(dynamic msg) {
    Map<String, dynamic> data = encoder.decode(String.fromCharCodes(msg));
    int idx = data["\$msg_idx"];
    if (idx > MessageIndex.values.length) {
      throw "Undecodable object $idx";
    }
    MessageIndex index = MessageIndex.values[idx];
    switch (index) {
      case MessageIndex.undefined:
        throw "Undecodable object undefined";
      {{- range $msg := .Messages}}
      case MessageIndex.{{$msg.Name}}:
        return {{$msg.Name}}FromMap(data);
      {{- end}}
    }
  }
}
