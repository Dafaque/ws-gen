// Code generated by wsgen. DO NOT EDIT.
import 'package:{{get_param "module"}}/{{get_param "package"}}/model/model.dart';
{{- if eq .Encoding "json"}}
import 'dart:convert' show json;
var encoder = json;
{{- end}}

abstract class Mapable {
  Map<String, dynamic> toMap();
}

abstract class Coder {
    dynamic encode(Mapable m);
    Mapable decode(dynamic data);
}


class DefaultCoder implements Coder {
  @override
  dynamic encode(Mapable m) {
    return encoder.encode(m.toMap());
  }

  @override
  Mapable decode(dynamic msg) {
    Map<String, dynamic> data = encoder.decode(String.fromCharCodes(msg));
    int idx = data["\$msg_idx"];
    if (idx > MessageIndex.values.length) {
      throw "Undecodable object $idx";
    }
    MessageIndex index = MessageIndex.values[idx];
    switch (index) {
      case MessageIndex.undefined:
        throw "Undecodable object undefined";
      {{- range $model := .Models}}
      case MessageIndex.{{$model.Name}}:
        return {{$model.Name}}FromMap(data);
      {{- end}}
    }
  }
}
